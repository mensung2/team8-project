<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
  <!-- 구글 noto sans 폰트 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css" rel="stylesheet">
  <!-- Reset CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <!-- 부트스트랩 CDN -->

  <title>자기소개 페이지</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-size: 16px;
      font-family: 'Noto Sans KR', sans-serif;
      color: #000;
      background-color: #fff;
    }

    li {
      list-style: none;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    img {
      vertical-align: top;
    }

    /* //common */




    #wrap {
      width: 100%;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }

    #wrap .main {
      width: 1350px;
      height: 600px;
      margin-top: 100px;
    }

    #wrap .introduce {
      width: 100%;
      height: 600px;
      background-color: #a3a3a3;
      display: grid;
      grid-template-columns: 1fr 1fr;
      /* 2열 구조 */
      gap: 50px;
    }

    #wrap .introduce .photo {
      width: 500px;
      height: 600px;
      background-color: #b3b3b3;
      grid-column: 1/2;
      grid-row: 1/3;
    }

    #wrap .introduce .contents {
      width: 800px;
      height: 500px;
      background-color: #c3c3c3;
      grid-column: 2/3;
      grid-row: 1/2;
    }

    #wrap .introduce .hashtag {
      width: 800px;
      height: 50px;
      grid-column: 2/3;
      grid-row: 2/3;
      background-color: #d3d3d3;
    }

    /* //main */
    #wrap .footer {
      margin-top: 50px;
      width: 1350px;
      height: 100px;
      background-color: #e3e3e3;
      display: flex;
      justify-content: center;
    }

    #wrap .footer .comment {
      width: 1000px;
      height: 100%;
      background-color: #a5a5a5;
    }

    #wrap .footer .comment #commentInput {}

    #wrap .footer .comment #passwordInput {}

    /* //footer */
  </style>
</head>

<body>
  <div id="wrap">
    <div class="main">
      <div class="introduce">
        <div class="photo"></div>
        <div class="contents"></div>
        <div class="hashtag"></div>
      </div>
    </div>
    <div class="footer">
      <div class="comment">
        <!-- <button type="button" class="btn btn-dark">Dark</button> -->
        <div class="container py-5">
          <form id="commentForm">
            <div class="mb-3">
              <label for="commentInput" class="form-label">댓글</label>
              <input type="text" class="form-control" id="commentInput" placeholder="댓글을 입력하세요">
            </div>
            <div class="mb-3">
              <label for="passwordInput" class="form-label">비밀번호</label>
              <input type="password" class="form-control" id="passwordInput" placeholder="비밀번호를 입력하세요">
            </div>
            <button type="submit" class="btn btn-primary">댓글 달기</button>
          </form>
          <div id="commentsList" class="mt-3"></div>
        </div>
      </div>


      <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-firestore.js"></script>
      <script>
        // 파이어베이스 설정
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyALCvTS0w8PDnupSIDwp-jlZmYiVk-0IkU",
          authDomain: "sparta-3c679.firebaseapp.com",
          projectId: "sparta-3c679",
          storageBucket: "sparta-3c679.appspot.com",
          messagingSenderId: "513535082637",
          appId: "1:513535082637:web:19049a3cba86baf339e2c4",
          measurementId: "G-BWQPHLCXVX"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const commentForm = document.getElementById('commentForm');
        const commentInput = document.getElementById('commentInput');
        const passwordInput = document.getElementById('passwordInput');
        const commentsList = document.getElementById('commentsList');

        // 댓글 제출
        commentForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const commentText = commentInput.value.trim();
          const password = passwordInput.value.trim();

          // 비밀번호 입력 확인
          if (password === '') {
            alert('비밀번호를 입력해주세요.');
            return; // 비밀번호가 입력되지 않았다면 함수를 여기서 종료
          }


          // 파이어베이스에 댓글과 비밀번호 저장
          db.collection('comments').add({
            text: commentText,
            password: password, // 비밀번호 저장
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          }).then(() => {
            commentInput.value = '';
            passwordInput.value = '';
            loadComments(); // 댓글 목록을 다시 불러옴
          });
        });

        // 댓글 목록 불러오기
        function loadComments() {
          commentsList.innerHTML = ''; // 목록 초기화
          db.collection('comments').orderBy('createdAt', 'desc').get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              const comment = doc.data();
              const commentElement = document.createElement('div');
              commentElement.textContent = comment.text + ' ';

              // 삭제 버튼 추가
              const deleteButton = document.createElement('button');
              deleteButton.textContent = '삭제';
              deleteButton.className = 'btn btn-danger btn-sm';
              deleteButton.onclick = function () {
                deleteComment(doc.id);
              };
              commentElement.appendChild(deleteButton);

              commentsList.appendChild(commentElement);
            });
          });
        }

        // 댓글 삭제
        function deleteComment(id) {
          const userPassword = prompt("댓글을 삭제하기 위한 비밀번호를 입력해주세요.");

          db.collection('comments').doc(id).get().then((doc) => {
            const comment = doc.data();
            if (comment.password === userPassword) {
              db.collection('comments').doc(id).delete().then(() => {
                loadComments(); // 삭제 후 댓글 목록을 다시 불러옴
                alert("댓글이 삭제되었습니다.");
              });
            } else {
              alert("비밀번호가 일치하지 않습니다.");
            }
          });
        }

        // 초기 댓글 목록 불러오기
        loadComments();
      </script>

    </div>
  </div>
  </div>
  </div>
</body>

</html>